name: Deploy CI

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:

  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
       sparse-checkout: |
        docker-compose.yml

    - name: Read package.json
      id: compose
      uses: juliangruber/read-file-action@v1
      with:
       path: docker-compose.yml

    - name: Echo package.json
      run: echo "${{ steps.package.outputs.content }}"
       
    - name: Deploy to DigitalOcean
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.DROPLET_HOST }}
        username: ${{ secrets.DROPLET_USERNAME }}
        key: ${{ secrets.DROPLET_SSH_PRIVATE_KEY }}
        passphrase: ${{ secrets.PASSPHRASE }}
        script: |
          # Log in to DockerHub
          echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
          
          # Ensure the directory exists
          #mkdir -p /web
          ddd=$(${{ steps.compose.outputs.content }})



          
